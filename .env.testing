# ==========================================
# Pathfinder 缩小版 - 测试环境配置
# ==========================================
# 专用于自动化测试和 CI/CD 的配置

# ==========================================
# 基础应用配置
# ==========================================
NODE_ENV=test
APP_NAME=Pathfinder Mini (Test)
APP_VERSION=1.0.0-test
TZ=UTC

# 测试环境端口
BACKEND_PORT=3001
FRONTEND_PORT=3002

# ==========================================
# 数据库配置 - PostgreSQL (测试)
# ==========================================
POSTGRES_DB=pathfinder_test
POSTGRES_USER=pathfinder_test
POSTGRES_PASSWORD=test123456
POSTGRES_PORT=5433

# 测试环境连接池
DB_POOL_MIN=1
DB_POOL_MAX=3
DB_POOL_TIMEOUT=5000
DB_CONNECTION_TIMEOUT=15000

DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@postgres:5433/${POSTGRES_DB}?schema=public&connection_limit=3

# ==========================================
# Redis 缓存配置 (测试)
# ==========================================
REDIS_PASSWORD=test123456
REDIS_PORT=6380
REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6380

REDIS_MAX_MEMORY=32mb
REDIS_MAX_MEMORY_POLICY=allkeys-lru

# ==========================================
# JWT 安全配置 (测试)
# ==========================================
JWT_SECRET=test-jwt-secret-key-for-testing-only
JWT_EXPIRES_IN=1h
JWT_REFRESH_EXPIRES_IN=2h
BCRYPT_ROUNDS=4

# ==========================================
# AI 服务配置 (测试 - Mock)
# ==========================================
GEMINI_API_KEY=test-mock-key
AI_MODEL=gemini-pro
AI_TEMPERATURE=0.5
AI_MAX_TOKENS=500

OPENAI_API_KEY=test-mock-key
OPENAI_MODEL=gpt-3.5-turbo

ENABLE_AI_FEATURES=false
AI_RATE_LIMIT=1000
MOCK_AI_RESPONSES=true

# ==========================================
# 前端配置 (测试)
# ==========================================
DOMAIN_NAME=test.localhost
API_BASE_URL=http://localhost:3001
WS_BASE_URL=ws://localhost:3001

CORS_ORIGIN=http://localhost:3002,http://test.localhost
CORS_CREDENTIALS=true

# ==========================================
# 文件上传配置 (测试)
# ==========================================
MAX_FILE_SIZE=1048576
ALLOWED_FILE_TYPES=image/jpeg,image/png,text/csv
UPLOAD_PATH=./test/uploads

# ==========================================
# 安全和限流配置 (测试 - 宽松)
# ==========================================
RATE_LIMIT_WINDOW=60000
RATE_LIMIT_MAX=10000
RATE_LIMIT_SKIP_SUCCESSFUL=true

HELMET_CSP_ENABLED=false
HELMET_HSTS_ENABLED=false

SESSION_SECRET=test-session-secret
SESSION_MAX_AGE=3600000
SESSION_SECURE=false

# ==========================================
# 日志配置 (测试 - 静默)
# ==========================================
LOG_LEVEL=error
LOG_FORMAT=json
LOG_FILE_ENABLED=false
LOG_CONSOLE_ENABLED=false
LOG_MAX_FILES=1
LOG_MAX_SIZE=1m

LOG_DIR=./test/logs

# ==========================================
# 监控配置 (测试 - 禁用)
# ==========================================
PROMETHEUS_ENABLED=false
METRICS_ENDPOINT=/metrics
METRICS_BASIC_AUTH=false

HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_ENDPOINT=/api/health

# ==========================================
# 数据库管理工具配置 (测试 - 禁用)
# ==========================================
PGADMIN_EMAIL=test@pathfinder.local
PGLADMIN_PASSWORD=test123456
PGADMIN_PORT=5051

REDIS_UI_USER=test
REDIS_UI_PASSWORD=test123456
REDIS_UI_PORT=8082

# ==========================================
# 备份配置 (测试 - 禁用)
# ==========================================
BACKUP_ENABLED=false
BACKUP_SCHEDULE=
BACKUP_RETENTION_DAYS=0
BACKUP_PATH=./test/backups

# ==========================================
# 邮件配置 (测试 - Mock)
# ==========================================
MAIL_ENABLED=false
SMTP_HOST=mock.smtp.test
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=test@test.com
SMTP_PASSWORD=testpass
MAIL_FROM=test@pathfinder.test

# ==========================================
# 缓存配置 (测试)
# ==========================================
CACHE_TTL=10
CACHE_MAX_SIZE=10
CACHE_ENABLED=true

# ==========================================
# 数据分析配置 (测试)
# ==========================================
ANALYTICS_BATCH_SIZE=10
ANALYTICS_PROCESS_INTERVAL=1000
ANALYTICS_RETENTION_DAYS=1

# ==========================================
# 定时任务配置 (测试 - 禁用)
# ==========================================
SCHEDULER_ENABLED=false
CLEANUP_INTERVAL=
ANALYTICS_CALCULATION_INTERVAL=
BACKUP_INTERVAL=

# ==========================================
# 开发和调试配置 (测试)
# ==========================================
DEBUG=false
DEBUG_SQL=false
ENABLE_REQUEST_LOGGING=false
ENABLE_CORS_DEBUG=false

HOT_RELOAD=false
WATCH_FILES=false

# ==========================================
# 生产环境优化配置 (测试 - 禁用)
# ==========================================
PM2_ENABLED=false
PM2_INSTANCES=1
PM2_MAX_MEMORY=128M

ENABLE_COMPRESSION=false
ENABLE_STATIC_CACHE=false
STATIC_CACHE_MAX_AGE=0

SSL_ENABLED=false

# ==========================================
# 环境特定配置 (测试)
# ==========================================
IS_DEVELOPMENT=false
IS_TESTING=true
IS_PRODUCTION=false

ENABLE_SWAGGER=false
ENABLE_GRAPHQL_PLAYGROUND=false
ENABLE_DEBUG_ENDPOINTS=true

# ==========================================
# 外部服务集成 (测试 - 禁用)
# ==========================================
SENTRY_ENABLED=false
SENTRY_DSN=
SENTRY_ENVIRONMENT=test

GA_TRACKING_ID=
GA_ENABLED=false

# ==========================================
# 资源限制 (测试 - 严格)
# ==========================================
MAX_CONCURRENT_REQUESTS=10
MAX_REQUEST_SIZE=1mb
MAX_JSON_SIZE=1mb
MAX_URL_LENGTH=1024

MAX_QUERY_TIMEOUT=5000
MAX_QUERY_ROWS=100

# ==========================================
# 自定义配置 (测试)
# ==========================================
MAX_FUNNELS_PER_USER=5
MAX_NODES_PER_FUNNEL=10
DEFAULT_FUNNEL_TEMPLATE=test_simple_funnel

DATA_RETENTION_DAYS=1
INACTIVE_USER_CLEANUP_DAYS=1
TEMP_FILE_CLEANUP_HOURS=1

# ==========================================
# 测试专用功能
# ==========================================
# 测试数据管理
AUTO_SEED_DATA=false
RESET_DB_BEFORE_TESTS=true
CLEANUP_DB_AFTER_TESTS=true

# 测试模式
ENABLE_TEST_MODE=true
MOCK_EXTERNAL_APIS=true
DISABLE_RATE_LIMITING=true

# 测试工具
ENABLE_TEST_ROUTES=true
ENABLE_TEST_FIXTURES=true
TEST_TIMEOUT=30000

# 覆盖率报告
ENABLE_COVERAGE=true
COVERAGE_REPORT_DIR=./test/coverage

# 性能测试
ENABLE_PERFORMANCE_TESTS=false
PERFORMANCE_THRESHOLD_MS=100

# ==========================================
# Jest 测试配置
# ==========================================
JEST_TIMEOUT=30000
JEST_VERBOSE=false
JEST_SILENT=true
JEST_MAX_WORKERS=2

# ==========================================
# Cypress E2E 测试配置
# ==========================================
CYPRESS_baseUrl=http://localhost:3002
CYPRESS_apiUrl=http://localhost:3001
CYPRESS_viewportWidth=1280
CYPRESS_viewportHeight=720
CYPRESS_defaultCommandTimeout=10000

# ==========================================
# 数据库测试配置
# ==========================================
# 使用内存数据库进行单元测试
USE_IN_MEMORY_DB=false
SQLITE_FILE=./test/test.db

# 事务回滚测试
USE_DB_TRANSACTIONS=true
ROLLBACK_AFTER_TESTS=true

# ==========================================
# CI/CD 专用配置
# ==========================================
CI=false
GITHUB_ACTIONS=false
GITLAB_CI=false

# 构建配置
BUILD_TARGET=test
SKIP_BUILD_OPTIMIZATION=true

# 部署配置
DEPLOY_TO_TEST_ENV=false
TEST_ENV_URL=http://test.pathfinder.local