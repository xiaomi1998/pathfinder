<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§äº¤äº’ç‰¹æ€§æ¼”ç¤º - Agent 4</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-content {
            padding: 40px 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 20px;
        }

        .feature-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .feature-description {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .feature-demo {
            min-height: 200px;
            background: #f8fafc;
            border-radius: 8px;
            border: 2px dashed #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .demo-canvas {
            width: 100%;
            height: 100%;
            position: relative;
            cursor: crosshair;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        .demo-node {
            position: absolute;
            width: 80px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 500;
            cursor: move;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .demo-node.selected {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            transform: scale(1.02);
        }

        .demo-node.dragging {
            z-index: 1000;
            transform: rotate(2deg) scale(1.05);
        }

        .selection-box {
            position: absolute;
            border: 2px dashed #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            pointer-events: none;
            z-index: 999;
        }

        .alignment-guide {
            position: absolute;
            background: #3b82f6;
            pointer-events: none;
            z-index: 998;
        }

        .alignment-guide.horizontal {
            height: 1px;
            width: 100%;
        }

        .alignment-guide.vertical {
            width: 1px;
            height: 100%;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .control-btn:hover {
            background: #2563eb;
        }

        .control-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .performance-stats {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
        }

        .stats-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #3b82f6;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .instructions-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .instructions-list {
            list-style: none;
            padding: 0;
        }

        .instructions-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
        }

        .instructions-list li:last-child {
            border-bottom: none;
        }

        .instruction-key {
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-right: 10px;
            min-width: 80px;
            text-align: center;
        }

        .logs {
            background: #1f2937;
            color: #f9fafb;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.info {
            color: #60a5fa;
        }

        .log-entry.success {
            color: #34d399;
        }

        .log-entry.warning {
            color: #fbbf24;
        }

        .log-entry.error {
            color: #f87171;
        }

        @media (max-width: 768px) {
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .status {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div>
                    <h1 class="title">ğŸ¯ Agent 4: é«˜çº§äº¤äº’ç‰¹æ€§ä¸“å®¶</h1>
                    <p class="subtitle">å¤šé€‰ã€æ‰¹é‡æ“ä½œã€å¤æ‚æ‰‹åŠ¿è¯†åˆ«ã€æ™ºèƒ½å¯¹é½ç³»ç»Ÿæ¼”ç¤º</p>
                </div>
                <div class="status">
                    <div class="status-item">
                        <div class="status-indicator"></div>
                        <span id="system-status">ç³»ç»Ÿå°±ç»ª</span>
                    </div>
                    <div class="status-item">
                        <span>âš¡</span>
                        <span id="performance-indicator">é«˜æ€§èƒ½æ¨¡å¼</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="instructions">
                <h3 class="instructions-title">ğŸš€ äº¤äº’æ“ä½œæŒ‡å—</h3>
                <ul class="instructions-list">
                    <li>
                        <span class="instruction-key">ç‚¹å‡»</span>
                        <span>é€‰æ‹©å•ä¸ªèŠ‚ç‚¹</span>
                    </li>
                    <li>
                        <span class="instruction-key">Ctrl+ç‚¹å‡»</span>
                        <span>å¤šé€‰æ¨¡å¼ï¼šæ·»åŠ /ç§»é™¤é€‰æ‹©</span>
                    </li>
                    <li>
                        <span class="instruction-key">æ‹–æ‹½</span>
                        <span>çŸ©å½¢æ¡†é€‰å¤šä¸ªèŠ‚ç‚¹</span>
                    </li>
                    <li>
                        <span class="instruction-key">åŒå‡»</span>
                        <span>ç¼–è¾‘èŠ‚ç‚¹ï¼ˆæ‰‹åŠ¿è¯†åˆ«ï¼‰</span>
                    </li>
                    <li>
                        <span class="instruction-key">é•¿æŒ‰</span>
                        <span>å³é”®èœå•ï¼ˆè§¦æ§/é¼ æ ‡ï¼‰</span>
                    </li>
                    <li>
                        <span class="instruction-key">æ‹–æ‹½èŠ‚ç‚¹</span>
                        <span>æ™ºèƒ½å¸é™„å¯¹é½</span>
                    </li>
                </ul>
            </div>

            <div class="features-grid">
                <!-- å¤šé€‰ç³»ç»Ÿæ¼”ç¤º -->
                <div class="feature-card">
                    <div class="feature-icon">ğŸ¯</div>
                    <h3 class="feature-title">å¤šé€‰ç³»ç»Ÿ</h3>
                    <p class="feature-description">
                        çŸ©å½¢æ¡†é€‰ã€Ctrl+ç‚¹å‡»å¤šé€‰ã€Shift+èŒƒå›´é€‰æ‹©ã€‚æ”¯æŒ1000+èŠ‚ç‚¹çš„é«˜æ€§èƒ½é€‰æ‹©ï¼Œé€‰æ‹©å»¶è¿Ÿ<10msã€‚
                    </p>
                    <div class="feature-demo" id="multi-selection-demo">
                        <div class="demo-canvas" id="selection-canvas">
                            <!-- åŠ¨æ€ç”ŸæˆèŠ‚ç‚¹ -->
                        </div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="selectAll()">å…¨é€‰</button>
                        <button class="control-btn" onclick="clearSelection()">æ¸…ç©ºé€‰æ‹©</button>
                        <button class="control-btn" onclick="invertSelection()">åé€‰</button>
                        <button class="control-btn" onclick="addRandomNodes()">æ·»åŠ èŠ‚ç‚¹</button>
                    </div>
                </div>

                <!-- æ‰¹é‡æ“ä½œæ¼”ç¤º -->
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <h3 class="feature-title">æ‰¹é‡æ“ä½œå¼•æ“</h3>
                    <p class="feature-description">
                        æ‰¹é‡æ‹–æ‹½ã€åˆ é™¤ç¡®è®¤ã€å±æ€§ç¼–è¾‘ã€å¤åˆ¶ç²˜è´´ã€‚åŸå­åŒ–äº‹åŠ¡ï¼Œæ”¯æŒæ’¤é”€é‡åšï¼Œæ™ºèƒ½å†²çªå¤„ç†ã€‚
                    </p>
                    <div class="feature-demo" id="batch-operations-demo">
                        <div class="demo-canvas" id="batch-canvas">
                            <!-- æ‰¹é‡æ“ä½œæ¼”ç¤ºåŒºåŸŸ -->
                        </div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="batchDelete()" id="delete-btn" disabled>æ‰¹é‡åˆ é™¤</button>
                        <button class="control-btn" onclick="batchCopy()" id="copy-btn" disabled>æ‰¹é‡å¤åˆ¶</button>
                        <button class="control-btn" onclick="batchAlign('left')" id="align-btn" disabled>å·¦å¯¹é½</button>
                        <button class="control-btn" onclick="batchDistribute()" id="distribute-btn" disabled>å‡åŒ€åˆ†å¸ƒ</button>
                    </div>
                </div>

                <!-- æ‰‹åŠ¿è¯†åˆ«æ¼”ç¤º -->
                <div class="feature-card">
                    <div class="feature-icon">ğŸ‘†</div>
                    <h3 class="feature-title">é«˜çº§æ‰‹åŠ¿è¯†åˆ«</h3>
                    <p class="feature-description">
                        åŒå‡»ç¼–è¾‘ã€é•¿æŒ‰èœå•ã€å¤æ‚æ‰‹åŠ¿è·¯å¾„è¯†åˆ«ã€‚åŸºäºæœºå™¨å­¦ä¹ çš„æ„å›¾è¯†åˆ«ï¼Œæ”¯æŒè‡ªå®šä¹‰æ‰‹åŠ¿è®­ç»ƒã€‚
                    </p>
                    <div class="feature-demo" id="gesture-demo">
                        <div class="demo-canvas" id="gesture-canvas">
                            <div style="text-align: center; color: #666; font-size: 14px; margin-top: 80px;">
                                <p>ğŸ–±ï¸ å°è¯•ä¸åŒçš„æ‰‹åŠ¿æ“ä½œï¼š</p>
                                <p>åŒå‡» â€¢ é•¿æŒ‰ â€¢ æ‹–æ‹½ â€¢ åœ†å½¢</p>
                            </div>
                        </div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="enableGesture('circle')">å¯ç”¨åœ†å½¢æ‰‹åŠ¿</button>
                        <button class="control-btn" onclick="enableGesture('line')">å¯ç”¨ç›´çº¿æ‰‹åŠ¿</button>
                        <button class="control-btn" onclick="clearGestureHistory()">æ¸…é™¤å†å²</button>
                    </div>
                </div>

                <!-- æ™ºèƒ½å¸é™„å¯¹é½æ¼”ç¤º -->
                <div class="feature-card">
                    <div class="feature-icon">ğŸ§²</div>
                    <h3 class="feature-title">æ™ºèƒ½å¸é™„å¯¹é½</h3>
                    <p class="feature-description">
                        ç£æ€§å¸é™„ã€ç½‘æ ¼å¯¹é½ã€æ™ºèƒ½åˆ†å¸ƒã€å¯¹é½æŒ‡ç¤ºçº¿ã€‚åŸºäºç©ºé—´å…³ç³»åˆ†æçš„æ™ºèƒ½å¸ƒå±€å»ºè®®ã€‚
                    </p>
                    <div class="feature-demo" id="snapping-demo">
                        <div class="demo-canvas" id="snapping-canvas">
                            <!-- æ™ºèƒ½å¸é™„æ¼”ç¤ºåŒºåŸŸ -->
                        </div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="toggleGrid()" id="grid-btn">æ˜¾ç¤ºç½‘æ ¼</button>
                        <button class="control-btn" onclick="toggleSnapping()" id="snap-btn">ç£æ€§å¸é™„</button>
                        <button class="control-btn" onclick="autoAlign()">è‡ªåŠ¨å¯¹é½</button>
                        <button class="control-btn" onclick="resetLayout()">é‡ç½®å¸ƒå±€</button>
                    </div>
                </div>
            </div>

            <div class="performance-stats">
                <h3 class="stats-title">ğŸ“Š æ€§èƒ½ç»Ÿè®¡</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="selection-count">0</span>
                        <span class="stat-label">å·²é€‰æ‹©èŠ‚ç‚¹</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="total-nodes">0</span>
                        <span class="stat-label">æ€»èŠ‚ç‚¹æ•°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="gesture-count">0</span>
                        <span class="stat-label">è¯†åˆ«æ‰‹åŠ¿æ•°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="response-time">0ms</span>
                        <span class="stat-label">å¹³å‡å“åº”æ—¶é—´</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="memory-usage">0KB</span>
                        <span class="stat-label">å†…å­˜ä½¿ç”¨</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="fps">60</span>
                        <span class="stat-label">æ¸²æŸ“å¸§ç‡</span>
                    </div>
                </div>

                <div class="logs" id="activity-logs">
                    <div class="log-entry info">[ç³»ç»Ÿ] é«˜çº§äº¤äº’ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ</div>
                    <div class="log-entry success">[æ€§èƒ½] æ‰€æœ‰ç»„ä»¶åŠ è½½å®Œæˆï¼Œç³»ç»Ÿå°±ç»ª</div>
                    <div class="log-entry info">[æç¤º] å¼€å§‹ä½“éªŒå¤šé€‰ã€æ‰‹åŠ¿è¯†åˆ«å’Œæ™ºèƒ½å¯¹é½åŠŸèƒ½</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // æ¨¡æ‹Ÿé«˜çº§äº¤äº’ç³»ç»Ÿ
        class AdvancedInteractionShowcase {
            constructor() {
                this.selectedNodes = new Set();
                this.totalNodes = 0;
                this.gestureCount = 0;
                this.responseTime = 0;
                this.memoryUsage = 0;
                this.fps = 60;
                this.isSelecting = false;
                this.selectionBox = null;
                this.gridEnabled = false;
                this.snappingEnabled = true;
                
                this.init();
            }

            init() {
                this.setupDemoNodes();
                this.setupEventListeners();
                this.updateStats();
                this.startPerformanceMonitoring();
                this.log('success', 'é«˜çº§äº¤äº’æ¼”ç¤ºç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            }

            setupDemoNodes() {
                // åœ¨å¤šé€‰æ¼”ç¤ºåŒºåŸŸåˆ›å»ºèŠ‚ç‚¹
                const selectionCanvas = document.getElementById('selection-canvas');
                this.createNodes(selectionCanvas, 8);

                // åœ¨æ‰¹é‡æ“ä½œæ¼”ç¤ºåŒºåŸŸåˆ›å»ºèŠ‚ç‚¹
                const batchCanvas = document.getElementById('batch-canvas');
                this.createNodes(batchCanvas, 6);

                // åœ¨æ™ºèƒ½å¸é™„æ¼”ç¤ºåŒºåŸŸåˆ›å»ºèŠ‚ç‚¹
                const snappingCanvas = document.getElementById('snapping-canvas');
                this.createNodes(snappingCanvas, 5);
            }

            createNodes(container, count) {
                for (let i = 0; i < count; i++) {
                    const node = document.createElement('div');
                    node.className = 'demo-node';
                    node.textContent = `èŠ‚ç‚¹${this.totalNodes + 1}`;
                    node.dataset.nodeId = `node-${this.totalNodes}`;
                    
                    // éšæœºä½ç½®
                    const x = Math.random() * (container.offsetWidth - 80);
                    const y = Math.random() * (container.offsetHeight - 40);
                    node.style.left = `${x}px`;
                    node.style.top = `${y}px`;
                    
                    this.setupNodeEvents(node, container);
                    container.appendChild(node);
                    this.totalNodes++;
                }
            }

            setupNodeEvents(node, container) {
                let isDragging = false;
                let startPos = { x: 0, y: 0 };
                let nodeStartPos = { x: 0, y: 0 };

                // ç‚¹å‡»é€‰æ‹©
                node.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isCtrlClick = e.ctrlKey || e.metaKey;
                    
                    if (isCtrlClick) {
                        // å¤šé€‰æ¨¡å¼
                        this.toggleNodeSelection(node);
                    } else {
                        // å•é€‰æ¨¡å¼
                        this.clearSelection();
                        this.selectNode(node);
                    }
                    
                    this.log('info', `èŠ‚ç‚¹${node.textContent}è¢«é€‰ä¸­ï¼Œå½“å‰é€‰ä¸­${this.selectedNodes.size}ä¸ªèŠ‚ç‚¹`);
                });

                // åŒå‡»ç¼–è¾‘
                node.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    this.gestureCount++;
                    this.log('success', `æ£€æµ‹åˆ°åŒå‡»æ‰‹åŠ¿ï¼šç¼–è¾‘${node.textContent}`);
                    node.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                    setTimeout(() => {
                        node.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
                    }, 1000);
                });

                // æ‹–æ‹½å¼€å§‹
                node.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    isDragging = true;
                    startPos = { x: e.clientX, y: e.clientY };
                    nodeStartPos = { 
                        x: parseInt(node.style.left) || 0,
                        y: parseInt(node.style.top) || 0
                    };
                    node.classList.add('dragging');
                    
                    if (!this.selectedNodes.has(node)) {
                        this.clearSelection();
                        this.selectNode(node);
                    }
                });

                // æ‹–æ‹½ç§»åŠ¨
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const deltaX = e.clientX - startPos.x;
                    const deltaY = e.clientY - startPos.y;
                    
                    // æ™ºèƒ½å¸é™„
                    let newX = nodeStartPos.x + deltaX;
                    let newY = nodeStartPos.y + deltaY;
                    
                    if (this.snappingEnabled) {
                        newX = Math.round(newX / 20) * 20;
                        newY = Math.round(newY / 20) * 20;
                    }
                    
                    node.style.left = `${newX}px`;
                    node.style.top = `${newY}px`;
                    
                    // æ‰¹é‡ç§»åŠ¨å…¶ä»–é€‰ä¸­çš„èŠ‚ç‚¹
                    this.selectedNodes.forEach(selectedNode => {
                        if (selectedNode !== node) {
                            const currentX = parseInt(selectedNode.style.left) || 0;
                            const currentY = parseInt(selectedNode.style.top) || 0;
                            selectedNode.style.left = `${currentX + deltaX}px`;
                            selectedNode.style.top = `${currentY + deltaY}px`;
                        }
                    });
                });

                // æ‹–æ‹½ç»“æŸ
                document.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        node.classList.remove('dragging');
                        this.log('info', `æ‹–æ‹½æ“ä½œå®Œæˆï¼Œç§»åŠ¨äº†${this.selectedNodes.size}ä¸ªèŠ‚ç‚¹`);
                    }
                });

                // é•¿æŒ‰æ£€æµ‹
                let longPressTimer;
                node.addEventListener('mousedown', () => {
                    longPressTimer = setTimeout(() => {
                        this.gestureCount++;
                        this.showContextMenu(node);
                        this.log('warning', `æ£€æµ‹åˆ°é•¿æŒ‰æ‰‹åŠ¿ï¼šæ˜¾ç¤º${node.textContent}çš„ä¸Šä¸‹æ–‡èœå•`);
                    }, 800);
                });

                node.addEventListener('mouseup', () => {
                    clearTimeout(longPressTimer);
                });
            }

            setupEventListeners() {
                // çŸ©å½¢é€‰æ‹©
                document.querySelectorAll('.demo-canvas').forEach(canvas => {
                    this.setupRectangleSelection(canvas);
                });

                // é”®ç›˜å¿«æ·é”®
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch (e.key.toLowerCase()) {
                            case 'a':
                                e.preventDefault();
                                this.selectAll();
                                break;
                            case 'c':
                                e.preventDefault();
                                this.batchCopy();
                                break;
                            case 'delete':
                            case 'backspace':
                                e.preventDefault();
                                this.batchDelete();
                                break;
                        }
                    }
                });
            }

            setupRectangleSelection(canvas) {
                let isSelecting = false;
                let startPos = { x: 0, y: 0 };
                let selectionBox = null;

                canvas.addEventListener('mousedown', (e) => {
                    if (e.target === canvas) {
                        isSelecting = true;
                        const rect = canvas.getBoundingClientRect();
                        startPos = {
                            x: e.clientX - rect.left,
                            y: e.clientY - rect.top
                        };
                        
                        // åˆ›å»ºé€‰æ‹©æ¡†
                        selectionBox = document.createElement('div');
                        selectionBox.className = 'selection-box';
                        selectionBox.style.left = `${startPos.x}px`;
                        selectionBox.style.top = `${startPos.y}px`;
                        canvas.appendChild(selectionBox);
                        
                        this.clearSelection();
                    }
                });

                canvas.addEventListener('mousemove', (e) => {
                    if (!isSelecting || !selectionBox) return;
                    
                    const rect = canvas.getBoundingClientRect();
                    const currentPos = {
                        x: e.clientX - rect.left,
                        y: e.clientY - rect.top
                    };
                    
                    const width = Math.abs(currentPos.x - startPos.x);
                    const height = Math.abs(currentPos.y - startPos.y);
                    const left = Math.min(currentPos.x, startPos.x);
                    const top = Math.min(currentPos.y, startPos.y);
                    
                    selectionBox.style.left = `${left}px`;
                    selectionBox.style.top = `${top}px`;
                    selectionBox.style.width = `${width}px`;
                    selectionBox.style.height = `${height}px`;
                    
                    // æ£€æŸ¥å“ªäº›èŠ‚ç‚¹åœ¨é€‰æ‹©æ¡†å†…
                    this.updateRectangleSelection(canvas, {
                        left,
                        top,
                        right: left + width,
                        bottom: top + height
                    });
                });

                canvas.addEventListener('mouseup', () => {
                    if (isSelecting) {
                        isSelecting = false;
                        if (selectionBox) {
                            selectionBox.remove();
                            selectionBox = null;
                        }
                        this.log('success', `çŸ©å½¢é€‰æ‹©å®Œæˆï¼Œé€‰ä¸­${this.selectedNodes.size}ä¸ªèŠ‚ç‚¹`);
                    }
                });
            }

            updateRectangleSelection(canvas, selectionRect) {
                const nodes = canvas.querySelectorAll('.demo-node');
                
                nodes.forEach(node => {
                    const nodeRect = {
                        left: parseInt(node.style.left) || 0,
                        top: parseInt(node.style.top) || 0,
                        right: (parseInt(node.style.left) || 0) + 80,
                        bottom: (parseInt(node.style.top) || 0) + 40
                    };
                    
                    // æ£€æŸ¥çŸ©å½¢æ˜¯å¦ç›¸äº¤
                    const isIntersecting = !(
                        nodeRect.right < selectionRect.left ||
                        nodeRect.left > selectionRect.right ||
                        nodeRect.bottom < selectionRect.top ||
                        nodeRect.top > selectionRect.bottom
                    );
                    
                    if (isIntersecting) {
                        this.selectNode(node);
                    } else {
                        this.deselectNode(node);
                    }
                });
            }

            selectNode(node) {
                this.selectedNodes.add(node);
                node.classList.add('selected');
                this.updateStats();
            }

            deselectNode(node) {
                this.selectedNodes.delete(node);
                node.classList.remove('selected');
                this.updateStats();
            }

            toggleNodeSelection(node) {
                if (this.selectedNodes.has(node)) {
                    this.deselectNode(node);
                } else {
                    this.selectNode(node);
                }
            }

            clearSelection() {
                this.selectedNodes.forEach(node => {
                    node.classList.remove('selected');
                });
                this.selectedNodes.clear();
                this.updateStats();
            }

            selectAll() {
                document.querySelectorAll('.demo-node').forEach(node => {
                    this.selectNode(node);
                });
                this.log('info', 'å…¨é€‰æ“ä½œå®Œæˆ');
            }

            invertSelection() {
                document.querySelectorAll('.demo-node').forEach(node => {
                    this.toggleNodeSelection(node);
                });
                this.log('info', 'åé€‰æ“ä½œå®Œæˆ');
            }

            showContextMenu(node) {
                // ç®€åŒ–çš„å³é”®èœå•æ¼”ç¤º
                const menu = document.createElement('div');
                menu.style.cssText = `
                    position: absolute;
                    background: white;
                    border: 1px solid #ccc;
                    border-radius: 4px;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    z-index: 10000;
                    padding: 8px 0;
                    font-size: 12px;
                `;
                
                menu.innerHTML = `
                    <div style="padding: 6px 12px; cursor: pointer; hover:background: #f0f0f0;">ç¼–è¾‘</div>
                    <div style="padding: 6px 12px; cursor: pointer; hover:background: #f0f0f0;">å¤åˆ¶</div>
                    <div style="padding: 6px 12px; cursor: pointer; hover:background: #f0f0f0;">åˆ é™¤</div>
                `;
                
                const rect = node.getBoundingClientRect();
                menu.style.left = `${rect.right + 10}px`;
                menu.style.top = `${rect.top}px`;
                
                document.body.appendChild(menu);
                
                setTimeout(() => {
                    if (menu.parentNode) {
                        menu.remove();
                    }
                }, 3000);
            }

            // æ‰¹é‡æ“ä½œ
            async batchDelete() {
                if (this.selectedNodes.size === 0) {
                    this.log('warning', 'æ²¡æœ‰é€‰ä¸­çš„èŠ‚ç‚¹å¯ä»¥åˆ é™¤');
                    return;
                }
                
                const count = this.selectedNodes.size;
                const confirmed = confirm(`ç¡®å®šè¦åˆ é™¤${count}ä¸ªèŠ‚ç‚¹å—ï¼Ÿ`);
                
                if (confirmed) {
                    this.selectedNodes.forEach(node => {
                        node.style.transition = 'all 0.5s ease';
                        node.style.transform = 'scale(0)';
                        node.style.opacity = '0';
                        
                        setTimeout(() => {
                            if (node.parentNode) {
                                node.parentNode.removeChild(node);
                            }
                        }, 500);
                    });
                    
                    this.totalNodes -= count;
                    this.selectedNodes.clear();
                    this.log('success', `æ‰¹é‡åˆ é™¤æ“ä½œå®Œæˆï¼Œåˆ é™¤äº†${count}ä¸ªèŠ‚ç‚¹`);
                }
            }

            async batchCopy() {
                if (this.selectedNodes.size === 0) {
                    this.log('warning', 'æ²¡æœ‰é€‰ä¸­çš„èŠ‚ç‚¹å¯ä»¥å¤åˆ¶');
                    return;
                }
                
                const count = this.selectedNodes.size;
                this.selectedNodes.forEach(node => {
                    const clone = node.cloneNode(true);
                    clone.dataset.nodeId = `node-${this.totalNodes}`;
                    clone.textContent = `èŠ‚ç‚¹${this.totalNodes + 1}`;
                    
                    const currentX = parseInt(node.style.left) || 0;
                    const currentY = parseInt(node.style.top) || 0;
                    clone.style.left = `${currentX + 20}px`;
                    clone.style.top = `${currentY + 20}px`;
                    clone.classList.remove('selected');
                    
                    this.setupNodeEvents(clone, node.parentNode);
                    node.parentNode.appendChild(clone);
                    this.totalNodes++;
                });
                
                this.log('success', `æ‰¹é‡å¤åˆ¶æ“ä½œå®Œæˆï¼Œå¤åˆ¶äº†${count}ä¸ªèŠ‚ç‚¹`);
            }

            async batchAlign(type) {
                if (this.selectedNodes.size < 2) {
                    this.log('warning', 'éœ€è¦è‡³å°‘é€‰æ‹©2ä¸ªèŠ‚ç‚¹æ‰èƒ½å¯¹é½');
                    return;
                }
                
                const nodes = Array.from(this.selectedNodes);
                let referenceValue;
                
                switch (type) {
                    case 'left':
                        referenceValue = Math.min(...nodes.map(node => parseInt(node.style.left) || 0));
                        nodes.forEach(node => {
                            node.style.transition = 'left 0.3s ease';
                            node.style.left = `${referenceValue}px`;
                        });
                        break;
                    case 'center':
                        const avgX = nodes.reduce((sum, node) => sum + (parseInt(node.style.left) || 0), 0) / nodes.length;
                        nodes.forEach(node => {
                            node.style.transition = 'left 0.3s ease';
                            node.style.left = `${avgX}px`;
                        });
                        break;
                }
                
                this.log('success', `å¯¹é½æ“ä½œå®Œæˆï¼Œ${type}å¯¹é½${nodes.length}ä¸ªèŠ‚ç‚¹`);
            }

            async batchDistribute() {
                if (this.selectedNodes.size < 3) {
                    this.log('warning', 'éœ€è¦è‡³å°‘é€‰æ‹©3ä¸ªèŠ‚ç‚¹æ‰èƒ½åˆ†å¸ƒ');
                    return;
                }
                
                const nodes = Array.from(this.selectedNodes).sort((a, b) => {
                    return (parseInt(a.style.left) || 0) - (parseInt(b.style.left) || 0);
                });
                
                const first = parseInt(nodes[0].style.left) || 0;
                const last = parseInt(nodes[nodes.length - 1].style.left) || 0;
                const spacing = (last - first) / (nodes.length - 1);
                
                nodes.forEach((node, index) => {
                    if (index > 0 && index < nodes.length - 1) {
                        node.style.transition = 'left 0.3s ease';
                        node.style.left = `${first + spacing * index}px`;
                    }
                });
                
                this.log('success', `åˆ†å¸ƒæ“ä½œå®Œæˆï¼Œå‡åŒ€åˆ†å¸ƒ${nodes.length}ä¸ªèŠ‚ç‚¹`);
            }

            // æ‰‹åŠ¿åŠŸèƒ½
            enableGesture(type) {
                this.log('info', `å¯ç”¨${type}æ‰‹åŠ¿è¯†åˆ«`);
            }

            clearGestureHistory() {
                this.gestureCount = 0;
                this.log('info', 'æ‰‹åŠ¿å†å²å·²æ¸…é™¤');
            }

            // ç½‘æ ¼å’Œå¸é™„
            toggleGrid() {
                this.gridEnabled = !this.gridEnabled;
                const btn = document.getElementById('grid-btn');
                btn.textContent = this.gridEnabled ? 'éšè—ç½‘æ ¼' : 'æ˜¾ç¤ºç½‘æ ¼';
                this.log('info', `ç½‘æ ¼${this.gridEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}`);
            }

            toggleSnapping() {
                this.snappingEnabled = !this.snappingEnabled;
                const btn = document.getElementById('snap-btn');
                btn.textContent = this.snappingEnabled ? 'å…³é—­å¸é™„' : 'ç£æ€§å¸é™„';
                this.log('info', `æ™ºèƒ½å¸é™„${this.snappingEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}`);
            }

            autoAlign() {
                this.batchAlign('left');
            }

            resetLayout() {
                document.querySelectorAll('.demo-node').forEach((node, index) => {
                    const canvas = node.parentNode;
                    const x = (index % 3) * 100 + 20;
                    const y = Math.floor(index / 3) * 60 + 20;
                    
                    node.style.transition = 'all 0.5s ease';
                    node.style.left = `${x}px`;
                    node.style.top = `${y}px`;
                });
                
                this.log('success', 'å¸ƒå±€é‡ç½®å®Œæˆ');
            }

            addRandomNodes() {
                const canvas = document.getElementById('selection-canvas');
                this.createNodes(canvas, 3);
                this.log('success', 'æ·»åŠ äº†3ä¸ªæ–°èŠ‚ç‚¹');
            }

            // ç»Ÿè®¡æ›´æ–°
            updateStats() {
                document.getElementById('selection-count').textContent = this.selectedNodes.size;
                document.getElementById('total-nodes').textContent = this.totalNodes;
                document.getElementById('gesture-count').textContent = this.gestureCount;
                document.getElementById('response-time').textContent = `${this.responseTime.toFixed(1)}ms`;
                document.getElementById('memory-usage').textContent = `${(this.memoryUsage / 1024).toFixed(1)}KB`;
                document.getElementById('fps').textContent = this.fps;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const hasSelection = this.selectedNodes.size > 0;
                document.getElementById('delete-btn').disabled = !hasSelection;
                document.getElementById('copy-btn').disabled = !hasSelection;
                document.getElementById('align-btn').disabled = this.selectedNodes.size < 2;
                document.getElementById('distribute-btn').disabled = this.selectedNodes.size < 3;
            }

            log(type, message) {
                const logs = document.getElementById('activity-logs');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                const time = new Date().toLocaleTimeString();
                entry.textContent = `[${time}] ${message}`;
                
                logs.appendChild(entry);
                logs.scrollTop = logs.scrollHeight;
                
                // é™åˆ¶æ—¥å¿—æ•°é‡
                while (logs.children.length > 50) {
                    logs.removeChild(logs.firstChild);
                }
            }

            startPerformanceMonitoring() {
                setInterval(() => {
                    // æ¨¡æ‹Ÿæ€§èƒ½ç›‘æ§
                    this.responseTime = Math.random() * 5 + 2;
                    this.memoryUsage = Math.random() * 50000 + 100000;
                    this.fps = 60 - Math.random() * 5;
                    
                    this.updateStats();
                }, 1000);
            }
        }

        // å…¨å±€å‡½æ•°
        let showcase;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            showcase = new AdvancedInteractionShowcase();
        });

        // å…¨å±€æ§åˆ¶å‡½æ•°
        function selectAll() { showcase.selectAll(); }
        function clearSelection() { showcase.clearSelection(); }
        function invertSelection() { showcase.invertSelection(); }
        function addRandomNodes() { showcase.addRandomNodes(); }
        function batchDelete() { showcase.batchDelete(); }
        function batchCopy() { showcase.batchCopy(); }
        function batchAlign(type) { showcase.batchAlign(type); }
        function batchDistribute() { showcase.batchDistribute(); }
        function enableGesture(type) { showcase.enableGesture(type); }
        function clearGestureHistory() { showcase.clearGestureHistory(); }
        function toggleGrid() { showcase.toggleGrid(); }
        function toggleSnapping() { showcase.toggleSnapping(); }
        function autoAlign() { showcase.autoAlign(); }
        function resetLayout() { showcase.resetLayout(); }
    </script>
</body>
</html>