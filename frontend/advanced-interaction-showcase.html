<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>È´òÁ∫ß‰∫§‰∫íÁâπÊÄßÊºîÁ§∫ - Agent 4</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 14px;
            color: #666;
            margin-top: 4px;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-content {
            padding: 40px 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin-bottom: 20px;
        }

        .feature-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .feature-description {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .feature-demo {
            min-height: 200px;
            background: #f8fafc;
            border-radius: 8px;
            border: 2px dashed #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .demo-canvas {
            width: 100%;
            height: 100%;
            position: relative;
            cursor: crosshair;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        .demo-node {
            position: absolute;
            width: 80px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 500;
            cursor: move;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .demo-node.selected {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            transform: scale(1.02);
        }

        .demo-node.dragging {
            z-index: 1000;
            transform: rotate(2deg) scale(1.05);
        }

        .selection-box {
            position: absolute;
            border: 2px dashed #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            pointer-events: none;
            z-index: 999;
        }

        .alignment-guide {
            position: absolute;
            background: #3b82f6;
            pointer-events: none;
            z-index: 998;
        }

        .alignment-guide.horizontal {
            height: 1px;
            width: 100%;
        }

        .alignment-guide.vertical {
            width: 1px;
            height: 100%;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .control-btn:hover {
            background: #2563eb;
        }

        .control-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .performance-stats {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
        }

        .stats-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #3b82f6;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .instructions-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .instructions-list {
            list-style: none;
            padding: 0;
        }

        .instructions-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
        }

        .instructions-list li:last-child {
            border-bottom: none;
        }

        .instruction-key {
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-right: 10px;
            min-width: 80px;
            text-align: center;
        }

        .logs {
            background: #1f2937;
            color: #f9fafb;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.info {
            color: #60a5fa;
        }

        .log-entry.success {
            color: #34d399;
        }

        .log-entry.warning {
            color: #fbbf24;
        }

        .log-entry.error {
            color: #f87171;
        }

        @media (max-width: 768px) {
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .status {
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div>
                    <h1 class="title">üéØ Agent 4: È´òÁ∫ß‰∫§‰∫íÁâπÊÄß‰∏ìÂÆ∂</h1>
                    <p class="subtitle">Â§öÈÄâ„ÄÅÊâπÈáèÊìç‰Ωú„ÄÅÂ§çÊùÇÊâãÂäøËØÜÂà´„ÄÅÊô∫ËÉΩÂØπÈΩêÁ≥ªÁªüÊºîÁ§∫</p>
                </div>
                <div class="status">
                    <div class="status-item">
                        <div class="status-indicator"></div>
                        <span id="system-status">Á≥ªÁªüÂ∞±Áª™</span>
                    </div>
                    <div class="status-item">
                        <span>‚ö°</span>
                        <span id="performance-indicator">È´òÊÄßËÉΩÊ®°Âºè</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="instructions">
                <h3 class="instructions-title">üöÄ ‰∫§‰∫íÊìç‰ΩúÊåáÂçó</h3>
                <ul class="instructions-list">
                    <li>
                        <span class="instruction-key">ÁÇπÂáª</span>
                        <span>ÈÄâÊã©Âçï‰∏™ËäÇÁÇπ</span>
                    </li>
                    <li>
                        <span class="instruction-key">Ctrl+ÁÇπÂáª</span>
                        <span>Â§öÈÄâÊ®°ÂºèÔºöÊ∑ªÂä†/ÁßªÈô§ÈÄâÊã©</span>
                    </li>
                    <li>
                        <span class="instruction-key">ÊãñÊãΩ</span>
                        <span>Áü©ÂΩ¢Ê°ÜÈÄâÂ§ö‰∏™ËäÇÁÇπ</span>
                    </li>
                    <li>
                        <span class="instruction-key">ÂèåÂáª</span>
                        <span>ÁºñËæëËäÇÁÇπÔºàÊâãÂäøËØÜÂà´Ôºâ</span>
                    </li>
                    <li>
                        <span class="instruction-key">ÈïøÊåâ</span>
                        <span>Âè≥ÈîÆËèúÂçïÔºàËß¶Êéß/Èº†Ê†áÔºâ</span>
                    </li>
                    <li>
                        <span class="instruction-key">ÊãñÊãΩËäÇÁÇπ</span>
                        <span>Êô∫ËÉΩÂê∏ÈôÑÂØπÈΩê</span>
                    </li>
                </ul>
            </div>

            <div class="features-grid">
                <!-- Â§öÈÄâÁ≥ªÁªüÊºîÁ§∫ -->
                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3 class="feature-title">Â§öÈÄâÁ≥ªÁªü</h3>
                    <p class="feature-description">
                        Áü©ÂΩ¢Ê°ÜÈÄâ„ÄÅCtrl+ÁÇπÂáªÂ§öÈÄâ„ÄÅShift+ËåÉÂõ¥ÈÄâÊã©„ÄÇÊîØÊåÅ1000+ËäÇÁÇπÁöÑÈ´òÊÄßËÉΩÈÄâÊã©ÔºåÈÄâÊã©Âª∂Ëøü<10ms„ÄÇ
                    </p>
                    <div class="feature-demo" id="multi-selection-demo">
                        <div class="demo-canvas" id="selection-canvas">
                            <!-- Âä®ÊÄÅÁîüÊàêËäÇÁÇπ -->
                        </div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="selectAll()">ÂÖ®ÈÄâ</button>
                        <button class="control-btn" onclick="clearSelection()">Ê∏ÖÁ©∫ÈÄâÊã©</button>
                        <button class="control-btn" onclick="invertSelection()">ÂèçÈÄâ</button>
                        <button class="control-btn" onclick="addRandomNodes()">Ê∑ªÂä†ËäÇÁÇπ</button>
                    </div>
                </div>

                <!-- ÊâπÈáèÊìç‰ΩúÊºîÁ§∫ -->
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3 class="feature-title">ÊâπÈáèÊìç‰ΩúÂºïÊìé</h3>
                    <p class="feature-description">
                        ÊâπÈáèÊãñÊãΩ„ÄÅÂà†Èô§Á°ÆËÆ§„ÄÅÂ±ûÊÄßÁºñËæë„ÄÅÂ§çÂà∂Á≤òË¥¥„ÄÇÂéüÂ≠êÂåñ‰∫ãÂä°ÔºåÊîØÊåÅÊí§ÈîÄÈáçÂÅöÔºåÊô∫ËÉΩÂÜ≤Á™ÅÂ§ÑÁêÜ„ÄÇ
                    </p>
                    <div class="feature-demo" id="batch-operations-demo">
                        <div class="demo-canvas" id="batch-canvas">
                            <!-- ÊâπÈáèÊìç‰ΩúÊºîÁ§∫Âå∫Âüü -->
                        </div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="batchDelete()" id="delete-btn" disabled>ÊâπÈáèÂà†Èô§</button>
                        <button class="control-btn" onclick="batchCopy()" id="copy-btn" disabled>ÊâπÈáèÂ§çÂà∂</button>
                        <button class="control-btn" onclick="batchAlign('left')" id="align-btn" disabled>Â∑¶ÂØπÈΩê</button>
                        <button class="control-btn" onclick="batchDistribute()" id="distribute-btn" disabled>ÂùáÂåÄÂàÜÂ∏É</button>
                    </div>
                </div>

                <!-- ÊâãÂäøËØÜÂà´ÊºîÁ§∫ -->
                <div class="feature-card">
                    <div class="feature-icon">üëÜ</div>
                    <h3 class="feature-title">È´òÁ∫ßÊâãÂäøËØÜÂà´</h3>
                    <p class="feature-description">
                        ÂèåÂáªÁºñËæë„ÄÅÈïøÊåâËèúÂçï„ÄÅÂ§çÊùÇÊâãÂäøË∑ØÂæÑËØÜÂà´„ÄÇÂü∫‰∫éÊú∫Âô®Â≠¶‰π†ÁöÑÊÑèÂõæËØÜÂà´ÔºåÊîØÊåÅËá™ÂÆö‰πâÊâãÂäøËÆ≠ÁªÉ„ÄÇ
                    </p>
                    <div class="feature-demo" id="gesture-demo">
                        <div class="demo-canvas" id="gesture-canvas">
                            <div style="text-align: center; color: #666; font-size: 14px; margin-top: 80px;">
                                <p>üñ±Ô∏è Â∞ùËØï‰∏çÂêåÁöÑÊâãÂäøÊìç‰ΩúÔºö</p>
                                <p>ÂèåÂáª ‚Ä¢ ÈïøÊåâ ‚Ä¢ ÊãñÊãΩ ‚Ä¢ ÂúÜÂΩ¢</p>
                            </div>
                        </div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="enableGesture('circle')">ÂêØÁî®ÂúÜÂΩ¢ÊâãÂäø</button>
                        <button class="control-btn" onclick="enableGesture('line')">ÂêØÁî®Áõ¥Á∫øÊâãÂäø</button>
                        <button class="control-btn" onclick="clearGestureHistory()">Ê∏ÖÈô§ÂéÜÂè≤</button>
                    </div>
                </div>

                <!-- Êô∫ËÉΩÂê∏ÈôÑÂØπÈΩêÊºîÁ§∫ -->
                <div class="feature-card">
                    <div class="feature-icon">üß≤</div>
                    <h3 class="feature-title">Êô∫ËÉΩÂê∏ÈôÑÂØπÈΩê</h3>
                    <p class="feature-description">
                        Á£ÅÊÄßÂê∏ÈôÑ„ÄÅÁΩëÊ†ºÂØπÈΩê„ÄÅÊô∫ËÉΩÂàÜÂ∏É„ÄÅÂØπÈΩêÊåáÁ§∫Á∫ø„ÄÇÂü∫‰∫éÁ©∫Èó¥ÂÖ≥Á≥ªÂàÜÊûêÁöÑÊô∫ËÉΩÂ∏ÉÂ±ÄÂª∫ËÆÆ„ÄÇ
                    </p>
                    <div class="feature-demo" id="snapping-demo">
                        <div class="demo-canvas" id="snapping-canvas">
                            <!-- Êô∫ËÉΩÂê∏ÈôÑÊºîÁ§∫Âå∫Âüü -->
                        </div>
                    </div>
                    <div class="controls">
                        <button class="control-btn" onclick="toggleGrid()" id="grid-btn">ÊòæÁ§∫ÁΩëÊ†º</button>
                        <button class="control-btn" onclick="toggleSnapping()" id="snap-btn">Á£ÅÊÄßÂê∏ÈôÑ</button>
                        <button class="control-btn" onclick="autoAlign()">Ëá™Âä®ÂØπÈΩê</button>
                        <button class="control-btn" onclick="resetLayout()">ÈáçÁΩÆÂ∏ÉÂ±Ä</button>
                    </div>
                </div>
            </div>

            <div class="performance-stats">
                <h3 class="stats-title">üìä ÊÄßËÉΩÁªüËÆ°</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="selection-count">0</span>
                        <span class="stat-label">Â∑≤ÈÄâÊã©ËäÇÁÇπ</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="total-nodes">0</span>
                        <span class="stat-label">ÊÄªËäÇÁÇπÊï∞</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="gesture-count">0</span>
                        <span class="stat-label">ËØÜÂà´ÊâãÂäøÊï∞</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="response-time">0ms</span>
                        <span class="stat-label">Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="memory-usage">0KB</span>
                        <span class="stat-label">ÂÜÖÂ≠ò‰ΩøÁî®</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="fps">60</span>
                        <span class="stat-label">Ê∏≤ÊüìÂ∏ßÁéá</span>
                    </div>
                </div>

                <div class="logs" id="activity-logs">
                    <div class="log-entry info">[Á≥ªÁªü] È´òÁ∫ß‰∫§‰∫íÁ≥ªÁªüÂàùÂßãÂåñÂÆåÊàê</div>
                    <div class="log-entry success">[ÊÄßËÉΩ] ÊâÄÊúâÁªÑ‰ª∂Âä†ËΩΩÂÆåÊàêÔºåÁ≥ªÁªüÂ∞±Áª™</div>
                    <div class="log-entry info">[ÊèêÁ§∫] ÂºÄÂßã‰ΩìÈ™åÂ§öÈÄâ„ÄÅÊâãÂäøËØÜÂà´ÂíåÊô∫ËÉΩÂØπÈΩêÂäüËÉΩ</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Ê®°ÊãüÈ´òÁ∫ß‰∫§‰∫íÁ≥ªÁªü
        class AdvancedInteractionShowcase {
            constructor() {
                this.selectedNodes = new Set();
                this.totalNodes = 0;
                this.gestureCount = 0;
                this.responseTime = 0;
                this.memoryUsage = 0;
                this.fps = 60;
                this.isSelecting = false;
                this.selectionBox = null;
                this.gridEnabled = false;
                this.snappingEnabled = true;
                
                this.init();
            }

            init() {
                this.setupDemoNodes();
                this.setupEventListeners();
                this.updateStats();
                this.startPerformanceMonitoring();
                this.log('success', 'È´òÁ∫ß‰∫§‰∫íÊºîÁ§∫Á≥ªÁªüÂàùÂßãÂåñÂÆåÊàê');
            }

            setupDemoNodes() {
                // Âú®Â§öÈÄâÊºîÁ§∫Âå∫ÂüüÂàõÂª∫ËäÇÁÇπ
                const selectionCanvas = document.getElementById('selection-canvas');
                this.createNodes(selectionCanvas, 8);

                // Âú®ÊâπÈáèÊìç‰ΩúÊºîÁ§∫Âå∫ÂüüÂàõÂª∫ËäÇÁÇπ
                const batchCanvas = document.getElementById('batch-canvas');
                this.createNodes(batchCanvas, 6);

                // Âú®Êô∫ËÉΩÂê∏ÈôÑÊºîÁ§∫Âå∫ÂüüÂàõÂª∫ËäÇÁÇπ
                const snappingCanvas = document.getElementById('snapping-canvas');
                this.createNodes(snappingCanvas, 5);
            }

            createNodes(container, count) {
                for (let i = 0; i < count; i++) {
                    const node = document.createElement('div');
                    node.className = 'demo-node';
                    node.textContent = `ËäÇÁÇπ${this.totalNodes + 1}`;
                    node.dataset.nodeId = `node-${this.totalNodes}`;
                    
                    // ÈöèÊú∫‰ΩçÁΩÆ
                    const x = Math.random() * (container.offsetWidth - 80);
                    const y = Math.random() * (container.offsetHeight - 40);
                    node.style.left = `${x}px`;
                    node.style.top = `${y}px`;
                    
                    this.setupNodeEvents(node, container);
                    container.appendChild(node);
                    this.totalNodes++;
                }
            }

            setupNodeEvents(node, container) {
                let isDragging = false;
                let startPos = { x: 0, y: 0 };
                let nodeStartPos = { x: 0, y: 0 };

                // ÁÇπÂáªÈÄâÊã©
                node.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isCtrlClick = e.ctrlKey || e.metaKey;
                    
                    if (isCtrlClick) {
                        // Â§öÈÄâÊ®°Âºè
                        this.toggleNodeSelection(node);
                    } else {
                        // ÂçïÈÄâÊ®°Âºè
                        this.clearSelection();
                        this.selectNode(node);
                    }
                    
                    this.log('info', `ËäÇÁÇπ${node.textContent}Ë¢´ÈÄâ‰∏≠ÔºåÂΩìÂâçÈÄâ‰∏≠${this.selectedNodes.size}‰∏™ËäÇÁÇπ`);
                });

                // ÂèåÂáªÁºñËæë
                node.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    this.gestureCount++;
                    this.log('success', `Ê£ÄÊµãÂà∞ÂèåÂáªÊâãÂäøÔºöÁºñËæë${node.textContent}`);
                    node.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                    setTimeout(() => {
                        node.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
                    }, 1000);
                });

                // ÊãñÊãΩÂºÄÂßã
                node.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    isDragging = true;
                    startPos = { x: e.clientX, y: e.clientY };
                    nodeStartPos = { 
                        x: parseInt(node.style.left) || 0,
                        y: parseInt(node.style.top) || 0
                    };
                    node.classList.add('dragging');
                    
                    if (!this.selectedNodes.has(node)) {
                        this.clearSelection();
                        this.selectNode(node);
                    }
                });

                // ÊãñÊãΩÁßªÂä®
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const deltaX = e.clientX - startPos.x;
                    const deltaY = e.clientY - startPos.y;
                    
                    // Êô∫ËÉΩÂê∏ÈôÑ
                    let newX = nodeStartPos.x + deltaX;
                    let newY = nodeStartPos.y + deltaY;
                    
                    if (this.snappingEnabled) {
                        newX = Math.round(newX / 20) * 20;
                        newY = Math.round(newY / 20) * 20;
                    }
                    
                    node.style.left = `${newX}px`;
                    node.style.top = `${newY}px`;
                    
                    // ÊâπÈáèÁßªÂä®ÂÖ∂‰ªñÈÄâ‰∏≠ÁöÑËäÇÁÇπ
                    this.selectedNodes.forEach(selectedNode => {
                        if (selectedNode !== node) {
                            const currentX = parseInt(selectedNode.style.left) || 0;
                            const currentY = parseInt(selectedNode.style.top) || 0;
                            selectedNode.style.left = `${currentX + deltaX}px`;
                            selectedNode.style.top = `${currentY + deltaY}px`;
                        }
                    });
                });

                // ÊãñÊãΩÁªìÊùü
                document.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        node.classList.remove('dragging');
                        this.log('info', `ÊãñÊãΩÊìç‰ΩúÂÆåÊàêÔºåÁßªÂä®‰∫Ü${this.selectedNodes.size}‰∏™ËäÇÁÇπ`);
                    }
                });

                // ÈïøÊåâÊ£ÄÊµã
                let longPressTimer;
                node.addEventListener('mousedown', () => {
                    longPressTimer = setTimeout(() => {
                        this.gestureCount++;
                        this.showContextMenu(node);
                        this.log('warning', `Ê£ÄÊµãÂà∞ÈïøÊåâÊâãÂäøÔºöÊòæÁ§∫${node.textContent}ÁöÑ‰∏ä‰∏ãÊñáËèúÂçï`);
                    }, 800);
                });

                node.addEventListener('mouseup', () => {
                    clearTimeout(longPressTimer);
                });
            }

            setupEventListeners() {
                // Áü©ÂΩ¢ÈÄâÊã©
                document.querySelectorAll('.demo-canvas').forEach(canvas => {
                    this.setupRectangleSelection(canvas);
                });

                // ÈîÆÁõòÂø´Êç∑ÈîÆ
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch (e.key.toLowerCase()) {
                            case 'a':
                                e.preventDefault();
                                this.selectAll();
                                break;
                            case 'c':
                                e.preventDefault();
                                this.batchCopy();
                                break;
                            case 'delete':
                            case 'backspace':
                                e.preventDefault();
                                this.batchDelete();
                                break;
                        }
                    }
                });
            }

            setupRectangleSelection(canvas) {
                let isSelecting = false;
                let startPos = { x: 0, y: 0 };
                let selectionBox = null;

                canvas.addEventListener('mousedown', (e) => {
                    if (e.target === canvas) {
                        isSelecting = true;
                        const rect = canvas.getBoundingClientRect();
                        startPos = {
                            x: e.clientX - rect.left,
                            y: e.clientY - rect.top
                        };
                        
                        // ÂàõÂª∫ÈÄâÊã©Ê°Ü
                        selectionBox = document.createElement('div');
                        selectionBox.className = 'selection-box';
                        selectionBox.style.left = `${startPos.x}px`;
                        selectionBox.style.top = `${startPos.y}px`;
                        canvas.appendChild(selectionBox);
                        
                        this.clearSelection();
                    }
                });

                canvas.addEventListener('mousemove', (e) => {
                    if (!isSelecting || !selectionBox) return;
                    
                    const rect = canvas.getBoundingClientRect();
                    const currentPos = {
                        x: e.clientX - rect.left,
                        y: e.clientY - rect.top
                    };
                    
                    const width = Math.abs(currentPos.x - startPos.x);
                    const height = Math.abs(currentPos.y - startPos.y);
                    const left = Math.min(currentPos.x, startPos.x);
                    const top = Math.min(currentPos.y, startPos.y);
                    
                    selectionBox.style.left = `${left}px`;
                    selectionBox.style.top = `${top}px`;
                    selectionBox.style.width = `${width}px`;
                    selectionBox.style.height = `${height}px`;
                    
                    // Ê£ÄÊü•Âì™‰∫õËäÇÁÇπÂú®ÈÄâÊã©Ê°ÜÂÜÖ
                    this.updateRectangleSelection(canvas, {
                        left,
                        top,
                        right: left + width,
                        bottom: top + height
                    });
                });

                canvas.addEventListener('mouseup', () => {
                    if (isSelecting) {
                        isSelecting = false;
                        if (selectionBox) {
                            selectionBox.remove();
                            selectionBox = null;
                        }
                        this.log('success', `Áü©ÂΩ¢ÈÄâÊã©ÂÆåÊàêÔºåÈÄâ‰∏≠${this.selectedNodes.size}‰∏™ËäÇÁÇπ`);
                    }
                });
            }

            updateRectangleSelection(canvas, selectionRect) {
                const nodes = canvas.querySelectorAll('.demo-node');
                
                nodes.forEach(node => {
                    const nodeRect = {
                        left: parseInt(node.style.left) || 0,
                        top: parseInt(node.style.top) || 0,
                        right: (parseInt(node.style.left) || 0) + 80,
                        bottom: (parseInt(node.style.top) || 0) + 40
                    };
                    
                    // Ê£ÄÊü•Áü©ÂΩ¢ÊòØÂê¶Áõ∏‰∫§
                    const isIntersecting = !(
                        nodeRect.right < selectionRect.left ||
                        nodeRect.left > selectionRect.right ||
                        nodeRect.bottom < selectionRect.top ||
                        nodeRect.top > selectionRect.bottom
                    );
                    
                    if (isIntersecting) {
                        this.selectNode(node);
                    } else {
                        this.deselectNode(node);
                    }
                });
            }

            selectNode(node) {
                this.selectedNodes.add(node);
                node.classList.add('selected');
                this.updateStats();
            }

            deselectNode(node) {
                this.selectedNodes.delete(node);
                node.classList.remove('selected');
                this.updateStats();
            }

            toggleNodeSelection(node) {
                if (this.selectedNodes.has(node)) {
                    this.deselectNode(node);
                } else {
                    this.selectNode(node);
                }
            }

            clearSelection() {
                this.selectedNodes.forEach(node => {
                    node.classList.remove('selected');
                });
                this.selectedNodes.clear();
                this.updateStats();
            }

            selectAll() {
                document.querySelectorAll('.demo-node').forEach(node => {
                    this.selectNode(node);
                });
                this.log('info', 'ÂÖ®ÈÄâÊìç‰ΩúÂÆåÊàê');
            }

            invertSelection() {
                document.querySelectorAll('.demo-node').forEach(node => {
                    this.toggleNodeSelection(node);
                });
                this.log('info', 'ÂèçÈÄâÊìç‰ΩúÂÆåÊàê');
            }

            showContextMenu(node) {
                // ÁÆÄÂåñÁöÑÂè≥ÈîÆËèúÂçïÊºîÁ§∫
                const menu = document.createElement('div');
                menu.style.cssText = `
                    position: absolute;
                    background: white;
                    border: 1px solid #ccc;
                    border-radius: 4px;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    z-index: 10000;
                    padding: 8px 0;
                    font-size: 12px;
                `;
                
                menu.innerHTML = `
                    <div style="padding: 6px 12px; cursor: pointer; hover:background: #f0f0f0;">ÁºñËæë</div>
                    <div style="padding: 6px 12px; cursor: pointer; hover:background: #f0f0f0;">Â§çÂà∂</div>
                    <div style="padding: 6px 12px; cursor: pointer; hover:background: #f0f0f0;">Âà†Èô§</div>
                `;
                
                const rect = node.getBoundingClientRect();
                menu.style.left = `${rect.right + 10}px`;
                menu.style.top = `${rect.top}px`;
                
                document.body.appendChild(menu);
                
                setTimeout(() => {
                    if (menu.parentNode) {
                        menu.remove();
                    }
                }, 3000);
            }

            // ÊâπÈáèÊìç‰Ωú
            async batchDelete() {
                if (this.selectedNodes.size === 0) {
                    this.log('warning', 'Ê≤°ÊúâÈÄâ‰∏≠ÁöÑËäÇÁÇπÂèØ‰ª•Âà†Èô§');
                    return;
                }
                
                const count = this.selectedNodes.size;
                const confirmed = confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§${count}‰∏™ËäÇÁÇπÂêóÔºü`);
                
                if (confirmed) {
                    this.selectedNodes.forEach(node => {
                        node.style.transition = 'all 0.5s ease';
                        node.style.transform = 'scale(0)';
                        node.style.opacity = '0';
                        
                        setTimeout(() => {
                            if (node.parentNode) {
                                node.parentNode.removeChild(node);
                            }
                        }, 500);
                    });
                    
                    this.totalNodes -= count;
                    this.selectedNodes.clear();
                    this.log('success', `ÊâπÈáèÂà†Èô§Êìç‰ΩúÂÆåÊàêÔºåÂà†Èô§‰∫Ü${count}‰∏™ËäÇÁÇπ`);
                }
            }

            async batchCopy() {
                if (this.selectedNodes.size === 0) {
                    this.log('warning', 'Ê≤°ÊúâÈÄâ‰∏≠ÁöÑËäÇÁÇπÂèØ‰ª•Â§çÂà∂');
                    return;
                }
                
                const count = this.selectedNodes.size;
                this.selectedNodes.forEach(node => {
                    const clone = node.cloneNode(true);
                    clone.dataset.nodeId = `node-${this.totalNodes}`;
                    clone.textContent = `ËäÇÁÇπ${this.totalNodes + 1}`;
                    
                    const currentX = parseInt(node.style.left) || 0;
                    const currentY = parseInt(node.style.top) || 0;
                    clone.style.left = `${currentX + 20}px`;
                    clone.style.top = `${currentY + 20}px`;
                    clone.classList.remove('selected');
                    
                    this.setupNodeEvents(clone, node.parentNode);
                    node.parentNode.appendChild(clone);
                    this.totalNodes++;
                });
                
                this.log('success', `ÊâπÈáèÂ§çÂà∂Êìç‰ΩúÂÆåÊàêÔºåÂ§çÂà∂‰∫Ü${count}‰∏™ËäÇÁÇπ`);
            }

            async batchAlign(type) {
                if (this.selectedNodes.size < 2) {
                    this.log('warning', 'ÈúÄË¶ÅËá≥Â∞ëÈÄâÊã©2‰∏™ËäÇÁÇπÊâçËÉΩÂØπÈΩê');
                    return;
                }
                
                const nodes = Array.from(this.selectedNodes);
                let referenceValue;
                
                switch (type) {
                    case 'left':
                        referenceValue = Math.min(...nodes.map(node => parseInt(node.style.left) || 0));
                        nodes.forEach(node => {
                            node.style.transition = 'left 0.3s ease';
                            node.style.left = `${referenceValue}px`;
                        });
                        break;
                    case 'center':
                        const avgX = nodes.reduce((sum, node) => sum + (parseInt(node.style.left) || 0), 0) / nodes.length;
                        nodes.forEach(node => {
                            node.style.transition = 'left 0.3s ease';
                            node.style.left = `${avgX}px`;
                        });
                        break;
                }
                
                this.log('success', `ÂØπÈΩêÊìç‰ΩúÂÆåÊàêÔºå${type}ÂØπÈΩê${nodes.length}‰∏™ËäÇÁÇπ`);
            }

            async batchDistribute() {
                if (this.selectedNodes.size < 3) {
                    this.log('warning', 'ÈúÄË¶ÅËá≥Â∞ëÈÄâÊã©3‰∏™ËäÇÁÇπÊâçËÉΩÂàÜÂ∏É');
                    return;
                }
                
                const nodes = Array.from(this.selectedNodes).sort((a, b) => {
                    return (parseInt(a.style.left) || 0) - (parseInt(b.style.left) || 0);
                });
                
                const first = parseInt(nodes[0].style.left) || 0;
                const last = parseInt(nodes[nodes.length - 1].style.left) || 0;
                const spacing = (last - first) / (nodes.length - 1);
                
                nodes.forEach((node, index) => {
                    if (index > 0 && index < nodes.length - 1) {
                        node.style.transition = 'left 0.3s ease';
                        node.style.left = `${first + spacing * index}px`;
                    }
                });
                
                this.log('success', `ÂàÜÂ∏ÉÊìç‰ΩúÂÆåÊàêÔºåÂùáÂåÄÂàÜÂ∏É${nodes.length}‰∏™ËäÇÁÇπ`);
            }

            // ÊâãÂäøÂäüËÉΩ
            enableGesture(type) {
                this.log('info', `ÂêØÁî®${type}ÊâãÂäøËØÜÂà´`);
            }

            clearGestureHistory() {
                this.gestureCount = 0;
                this.log('info', 'ÊâãÂäøÂéÜÂè≤Â∑≤Ê∏ÖÈô§');
            }

            // ÁΩëÊ†ºÂíåÂê∏ÈôÑ
            toggleGrid() {
                this.gridEnabled = !this.gridEnabled;
                const btn = document.getElementById('grid-btn');
                btn.textContent = this.gridEnabled ? 'ÈöêËóèÁΩëÊ†º' : 'ÊòæÁ§∫ÁΩëÊ†º';
                this.log('info', `ÁΩëÊ†º${this.gridEnabled ? 'Â∑≤ÂêØÁî®' : 'Â∑≤Á¶ÅÁî®'}`);
            }

            toggleSnapping() {
                this.snappingEnabled = !this.snappingEnabled;
                const btn = document.getElementById('snap-btn');
                btn.textContent = this.snappingEnabled ? 'ÂÖ≥Èó≠Âê∏ÈôÑ' : 'Á£ÅÊÄßÂê∏ÈôÑ';
                this.log('info', `Êô∫ËÉΩÂê∏ÈôÑ${this.snappingEnabled ? 'Â∑≤ÂêØÁî®' : 'Â∑≤Á¶ÅÁî®'}`);
            }

            autoAlign() {
                this.batchAlign('left');
            }

            resetLayout() {
                document.querySelectorAll('.demo-node').forEach((node, index) => {
                    const canvas = node.parentNode;
                    const x = (index % 3) * 100 + 20;
                    const y = Math.floor(index / 3) * 60 + 20;
                    
                    node.style.transition = 'all 0.5s ease';
                    node.style.left = `${x}px`;
                    node.style.top = `${y}px`;
                });
                
                this.log('success', 'Â∏ÉÂ±ÄÈáçÁΩÆÂÆåÊàê');
            }

            addRandomNodes() {
                const canvas = document.getElementById('selection-canvas');
                this.createNodes(canvas, 3);
                this.log('success', 'Ê∑ªÂä†‰∫Ü3‰∏™Êñ∞ËäÇÁÇπ');
            }

            // ÁªüËÆ°Êõ¥Êñ∞
            updateStats() {
                document.getElementById('selection-count').textContent = this.selectedNodes.size;
                document.getElementById('total-nodes').textContent = this.totalNodes;
                document.getElementById('gesture-count').textContent = this.gestureCount;
                document.getElementById('response-time').textContent = `${this.responseTime.toFixed(1)}ms`;
                document.getElementById('memory-usage').textContent = `${(this.memoryUsage / 1024).toFixed(1)}KB`;
                document.getElementById('fps').textContent = this.fps;
                
                // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                const hasSelection = this.selectedNodes.size > 0;
                document.getElementById('delete-btn').disabled = !hasSelection;
                document.getElementById('copy-btn').disabled = !hasSelection;
                document.getElementById('align-btn').disabled = this.selectedNodes.size < 2;
                document.getElementById('distribute-btn').disabled = this.selectedNodes.size < 3;
            }

            log(type, message) {
                const logs = document.getElementById('activity-logs');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                const time = new Date().toLocaleTimeString();
                entry.textContent = `[${time}] ${message}`;
                
                logs.appendChild(entry);
                logs.scrollTop = logs.scrollHeight;
                
                // ÈôêÂà∂Êó•ÂøóÊï∞Èáè
                while (logs.children.length > 50) {
                    logs.removeChild(logs.firstChild);
                }
            }

            startPerformanceMonitoring() {
                setInterval(() => {
                    // Ê®°ÊãüÊÄßËÉΩÁõëÊéß
                    this.responseTime = Math.random() * 5 + 2;
                    this.memoryUsage = Math.random() * 50000 + 100000;
                    this.fps = 60 - Math.random() * 5;
                    
                    this.updateStats();
                }, 1000);
            }
        }

        // ÂÖ®Â±ÄÂáΩÊï∞
        let showcase;

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            showcase = new AdvancedInteractionShowcase();
        });

        // ÂÖ®Â±ÄÊéßÂà∂ÂáΩÊï∞
        function selectAll() { showcase.selectAll(); }
        function clearSelection() { showcase.clearSelection(); }
        function invertSelection() { showcase.invertSelection(); }
        function addRandomNodes() { showcase.addRandomNodes(); }
        function batchDelete() { showcase.batchDelete(); }
        function batchCopy() { showcase.batchCopy(); }
        function batchAlign(type) { showcase.batchAlign(type); }
        function batchDistribute() { showcase.batchDistribute(); }
        function enableGesture(type) { showcase.enableGesture(type); }
        function clearGestureHistory() { showcase.clearGestureHistory(); }
        function toggleGrid() { showcase.toggleGrid(); }
        function toggleSnapping() { showcase.toggleSnapping(); }
        function autoAlign() { showcase.autoAlign(); }
        function resetLayout() { showcase.resetLayout(); }
    </script>
</body>
</html>