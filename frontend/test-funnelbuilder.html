<!DOCTYPE html>
<html>
<head>
    <title>FunnelBuilder 组件测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px;
        }
        .success { background: #d1f2eb; border: 1px solid #27ae60; }
        .error { background: #fadbd8; border: 1px solid #e74c3c; }
        .info { background: #d6eaf8; border: 1px solid #3498db; }
    </style>
</head>
<body>
    <h1>FunnelBuilder 组件加载测试</h1>
    
    <div id="test-results"></div>
    
    <script>
        const results = document.getElementById('test-results');
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }
        
        async function testFunnelBuilder() {
            addResult('🚀 开始测试 FunnelBuilder 组件加载...');
            
            try {
                // 测试前端服务器响应
                addResult('🔄 测试前端服务器...');
                const frontendResponse = await fetch('http://localhost:3000/');
                if (frontendResponse.ok) {
                    addResult('✅ 前端服务器运行正常', 'success');
                } else {
                    addResult(`❌ 前端服务器响应异常: ${frontendResponse.status}`, 'error');
                    return;
                }
                
                // 测试后端API
                addResult('🔄 测试后端API...');
                const backendResponse = await fetch('http://localhost:8080/health');
                if (backendResponse.ok) {
                    const data = await backendResponse.json();
                    addResult(`✅ 后端API运行正常: ${data.message}`, 'success');
                } else {
                    addResult(`❌ 后端API响应异常: ${backendResponse.status}`, 'error');
                }
                
                // 测试直接访问FunnelBuilder页面
                addResult('🔄 测试 FunnelBuilder 页面访问...');
                try {
                    // 首先测试是否需要认证
                    const funnelResponse = await fetch('http://localhost:3000/funnels/create', {
                        method: 'GET',
                        mode: 'no-cors'
                    });
                    addResult('📋 FunnelBuilder 页面请求已发送', 'info');
                    
                    // 尝试通过导航测试
                    addResult('🔄 准备导航测试 - 点击下面的按钮进行手动测试');
                    
                    // 创建导航按钮
                    const navButton = document.createElement('button');
                    navButton.innerHTML = '🔗 导航到 FunnelBuilder 页面';
                    navButton.style.cssText = 'padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 10px 0;';
                    navButton.onclick = function() {
                        addResult('🔄 尝试导航到 FunnelBuilder...');
                        window.open('http://localhost:3000/funnels/create', '_blank');
                    };
                    results.appendChild(navButton);
                    
                    // 创建登录测试按钮
                    const loginButton = document.createElement('button');
                    loginButton.innerHTML = '🔐 先登录再测试';
                    loginButton.style.cssText = 'padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 10px;';
                    loginButton.onclick = function() {
                        addResult('🔄 导航到登录页面...');
                        window.open('http://localhost:3000/login', '_blank');
                    };
                    results.appendChild(loginButton);
                    
                } catch (navError) {
                    addResult(`❌ FunnelBuilder 页面导航失败: ${navError.message}`, 'error');
                }
                
            } catch (error) {
                addResult(`❌ 测试过程中出现错误: ${error.message}`, 'error');
            }
        }
        
        // 页面加载完成后自动开始测试
        window.onload = function() {
            addResult('📋 测试页面已加载');
            testFunnelBuilder();
        };
    </script>
</body>
</html>