# Pathfinder Backend API

Pathfinder é¡¹ç›®çš„ Node.js + Express + TypeScript åç«¯ APIã€‚

## æŠ€æœ¯æ ˆ

- **Node.js** - JavaScript è¿è¡Œç¯å¢ƒ
- **Express.js** - Web åº”ç”¨æ¡†æ¶  
- **TypeScript** - ç±»å‹å®‰å…¨çš„ JavaScript
- **Prisma** - ç°ä»£æ•°æ®åº“ ORM
- **PostgreSQL** - å…³ç³»å‹æ•°æ®åº“
- **JWT** - ç”¨æˆ·è®¤è¯
- **Docker** - å®¹å™¨åŒ–éƒ¨ç½²

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ** - æ³¨å†Œã€ç™»å½•ã€JWT è®¤è¯
- ğŸ“Š **æ¼æ–—ç®¡ç†** - åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤æ¼æ–—
- ğŸ”— **èŠ‚ç‚¹å’Œè¿æ¥ç®¡ç†** - æ¼æ–—èŠ‚ç‚¹çš„å¢åˆ æ”¹æŸ¥
- ğŸ“ˆ **æ•°æ®åˆ†æ** - è½¬åŒ–ç‡ç»Ÿè®¡å’Œæ€§èƒ½åˆ†æ
- ğŸ¤– **AI åŠŸèƒ½** - æ™ºèƒ½å¯¹è¯å’Œåˆ†æå»ºè®®
- ğŸ›¡ï¸ **å®‰å…¨ç‰¹æ€§** - è¯·æ±‚éªŒè¯ã€é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½•
- ğŸš€ **é«˜æ€§èƒ½** - ç¼“å­˜ã€å‹ç¼©ã€é€Ÿç‡é™åˆ¶

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ types/          # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ routes/         # API è·¯ç”±
â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ app.ts          # åº”ç”¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma   # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”œâ”€â”€ Dockerfile.dev      # å¼€å‘ç¯å¢ƒå®¹å™¨é…ç½®
â”œâ”€â”€ package.json        # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json       # TypeScript é…ç½®
â””â”€â”€ .env.example        # ç¯å¢ƒå˜é‡ç¤ºä¾‹
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Node.js 18.0.0+
- PostgreSQL 13+
- npm 9.0.0+

### 2. å®‰è£…ä¾èµ–

```bash
cd backend
npm install
```

### 3. ç¯å¢ƒé…ç½®

å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶å¹¶ä¿®æ”¹é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å…³é”®å‚æ•°ï¼š

```env
DATABASE_URL="postgresql://username:password@localhost:5432/pathfinder"
JWT_SECRET="your-super-secure-jwt-secret-key"
```

### 4. æ•°æ®åº“è®¾ç½®

```bash
# ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
npm run db:generate

# æ¨é€æ•°æ®åº“ schema (å¼€å‘ç¯å¢ƒ)
npm run db:push

# æˆ–è€…ä½¿ç”¨è¿ç§» (ç”Ÿäº§ç¯å¢ƒæ¨è)
npm run db:migrate
```

### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:3001` å¯åŠ¨ã€‚

### 6. å¥åº·æ£€æŸ¥

è®¿é—® `http://localhost:3001/health` éªŒè¯æœåŠ¡å™¨çŠ¶æ€ã€‚

## API æ–‡æ¡£

### è®¤è¯ç«¯ç‚¹

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/auth/register` | ç”¨æˆ·æ³¨å†Œ |
| POST | `/api/auth/login` | ç”¨æˆ·ç™»å½• |
| POST | `/api/auth/logout` | ç”¨æˆ·ç™»å‡º |
| POST | `/api/auth/refresh` | åˆ·æ–°ä»¤ç‰Œ |
| GET  | `/api/auth/verify` | éªŒè¯ä»¤ç‰Œ |

### ç”¨æˆ·ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET  | `/api/users/me` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |
| PUT  | `/api/users/me` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ |
| PUT  | `/api/users/me/password` | æ›´æ”¹å¯†ç  |
| GET  | `/api/users/me/stats` | è·å–ç”¨æˆ·ç»Ÿè®¡ |

### æ¼æ–—ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET  | `/api/funnels` | è·å–ç”¨æˆ·æ¼æ–—åˆ—è¡¨ |
| POST | `/api/funnels` | åˆ›å»ºæ–°æ¼æ–— |
| GET  | `/api/funnels/:id` | è·å–æ¼æ–—è¯¦æƒ… |
| PUT  | `/api/funnels/:id` | æ›´æ–°æ¼æ–— |
| DELETE | `/api/funnels/:id` | åˆ é™¤æ¼æ–— |

### èŠ‚ç‚¹ç®¡ç†

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/nodes` | åˆ›å»ºèŠ‚ç‚¹ |
| GET  | `/api/nodes/:id` | è·å–èŠ‚ç‚¹è¯¦æƒ… |
| PUT  | `/api/nodes/:id` | æ›´æ–°èŠ‚ç‚¹ |
| DELETE | `/api/nodes/:id` | åˆ é™¤èŠ‚ç‚¹ |

### AI åŠŸèƒ½

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/ai/chat` | AI å¯¹è¯ |
| POST | `/api/ai/analyze` | æ¼æ–—åˆ†æ |
| GET  | `/api/ai/sessions` | è·å–å¯¹è¯å†å² |

## å¼€å‘æŒ‡å—

### æ•°æ®åº“æ“ä½œ

```bash
# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
npm run db:studio

# é‡ç½®æ•°æ®åº“
npm run db:reset

# ç”Ÿæˆç§å­æ•°æ®
npm run db:seed
```

### ä»£ç è§„èŒƒ

```bash
# ç±»å‹æ£€æŸ¥
npm run type-check

# ä»£ç æ£€æŸ¥
npm run lint

# è‡ªåŠ¨ä¿®å¤
npm run lint:fix

# ä»£ç æ ¼å¼åŒ–
npm run format
```

### æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
npm test

# ç›‘å¬æ¨¡å¼
npm run test:watch
```

## Docker éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ

```bash
# æ„å»ºå¼€å‘é•œåƒ
docker build -f Dockerfile.dev -t pathfinder-backend:dev .

# è¿è¡Œå®¹å™¨
docker run -p 3001:3001 --env-file .env pathfinder-backend:dev
```

### ç”Ÿäº§ç¯å¢ƒ

ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•çš„ `docker-compose.yml`ï¼š

```bash
cd ..
docker-compose up -d backend
```

## ç¯å¢ƒå˜é‡è¯´æ˜

### å¿…éœ€å˜é‡

- `DATABASE_URL` - PostgreSQL æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- `JWT_SECRET` - JWT ç­¾åå¯†é’¥ (è‡³å°‘32ä¸ªå­—ç¬¦)

### å¯é€‰å˜é‡

- `NODE_ENV` - è¿è¡Œç¯å¢ƒ (development/production)
- `PORT` - æœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 3001)
- `FRONTEND_URL` - å‰ç«¯åº”ç”¨ URL (CORS é…ç½®)
- `JWT_EXPIRES_IN` - JWT è¿‡æœŸæ—¶é—´ (é»˜è®¤: 7d)
- `LOG_LEVEL` - æ—¥å¿—çº§åˆ« (error/warn/info/debug)

## ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—ç³»ç»Ÿ

- å¼€å‘ç¯å¢ƒï¼šæ§åˆ¶å°è¾“å‡ºå½©è‰²æ—¥å¿—
- ç”Ÿäº§ç¯å¢ƒï¼šæ–‡ä»¶æ—¥å¿— + ç»“æ„åŒ–æ ¼å¼
- æ”¯æŒæ—¥å¿—çº§åˆ«ï¼šerror, warn, info, debug

### å¥åº·æ£€æŸ¥

è®¿é—® `/health` ç«¯ç‚¹è·å–æœåŠ¡çŠ¶æ€ï¼š

```json
{
  "status": "ok",
  "timestamp": "2024-01-01T12:00:00.000Z",
  "uptime": 3600,
  "environment": "development",
  "version": "1.0.0"
}
```

## å®‰å…¨ç‰¹æ€§

- **JWT è®¤è¯** - åŸºäºä»¤ç‰Œçš„ç”¨æˆ·è®¤è¯
- **å¯†ç å“ˆå¸Œ** - bcrypt åŠ å¯†å­˜å‚¨
- **è¾“å…¥éªŒè¯** - express-validator å‚æ•°éªŒè¯  
- **CORS é…ç½®** - è·¨åŸŸè¯·æ±‚æ§åˆ¶
- **é€Ÿç‡é™åˆ¶** - é˜²æ­¢ API æ»¥ç”¨
- **å®‰å…¨å¤´** - Helmet ä¸­é—´ä»¶
- **é”™è¯¯å¤„ç†** - ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼

## æ€§èƒ½ä¼˜åŒ–

- **æ•°æ®åº“ç´¢å¼•** - ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- **å“åº”å‹ç¼©** - gzip å‹ç¼©
- **è¯·æ±‚ç¼“å­˜** - Redis ç¼“å­˜æ”¯æŒ
- **è¿æ¥æ± ** - Prisma è¿æ¥ç®¡ç†
- **åˆ†é¡µæŸ¥è¯¢** - å¤§æ•°æ®é›†åˆ†é¡µå¤„ç†

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ `DATABASE_URL` é…ç½®
   - ç¡®è®¤ PostgreSQL æœåŠ¡è¿è¡Œ
   - éªŒè¯æ•°æ®åº“ç”¨æˆ·æƒé™

2. **JWT è®¤è¯é”™è¯¯**
   - æ£€æŸ¥ `JWT_SECRET` è®¾ç½®
   - ç¡®è®¤ä»¤ç‰Œæ ¼å¼æ­£ç¡®
   - éªŒè¯ä»¤ç‰Œæœªè¿‡æœŸ

3. **ç«¯å£å ç”¨**
   - ä¿®æ”¹ `PORT` ç¯å¢ƒå˜é‡
   - æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
LOG_LEVEL=debug npm run dev
```

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç æ›´æ”¹  
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

MIT License - æŸ¥çœ‹ [LICENSE](../LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åˆ›å»º Issue æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚